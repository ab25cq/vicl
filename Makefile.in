#######################################################
# installed directories
#######################################################
prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
datadir=@datadir@
mandir=@mandir@
sharedstatedir=@sharedstatedir@
sysconfdir=@sysconfdir@/clover2
includedir=@includedir@/clover2
datarootdir=@datarootdir@/clover2
docdir=@datadir@/doc
libdir=@libdir@


##########################################################
# environmnet variables
##########################################################
CC=@CC@
CXX=@CXX@
INSTALL=@INSTALL@
CFLAGS=@CFLAGS@
LIBS=@LIBS@
OS=@OS@
DESTDIR=@DESTDIR@
OBJS=@OBJS@
CXXFLAGS=@CXXFLAGS@

##########################################################
# main
##########################################################
all: vicl

vicl: ViClone.oclcl viclone.ocl viclone_open_file.ocl viclone_insert_file.ocl Clover.oclcl preinstall

Clover.oclcl: Fundamental.clcl CLParser.clcl
	cclover2 Fundamental.clcl
	if test -e Clover.oclcl; then bclover2 Clover.oclcl; fi

ViClone.oclcl: vicl1Lib.clcl
	cclover2 vicl14CCompletion.clcl
	if test -e ViClone.oclcl; then bclover2 ViClone.oclcl; fi

viclone.ocl: viclone.cl
	cclover2 viclone.cl
	install -m 644 viclone.ocl $(HOME)/.clover2/viclone.ocl

viclone_insert_file.ocl:viclone_insert_file.cl
	cclover2 viclone_insert_file.cl
	install -m 644 viclone_insert_file.ocl $(HOME)/.clover2/viclone_insert_file.ocl

viclone_open_file.ocl:viclone_open_file.cl
	cclover2 viclone_open_file.cl
	install -m 644 viclone_open_file.ocl $(HOME)/.clover2/viclone_open_file.ocl

preinstall:
	mkdir -p $(HOME)/.clover2/vicl
	install -m 644 Clover.oclcl $(HOME)/.clover2/vicl
	if test -e Clover.so.1.0.0; then install -m 755 Clover.so.1.0.0 $(HOME)/.clover2/vicl; cp -a Clover.so $(HOME)/.clover2/vicl; fi
	install -m 644 ViClone.oclcl $(HOME)/.clover2/vicl
	if test -e ViClone.so.1.0.0; then install -m 755 ViClone.so.1.0.0 $(HOME)/.clover2/vicl; cp -a ViClone.so $(HOME)/.clover2/vicl; fi
	install -m 644 viclone.ocl $(HOME)/.clover2/vicl

#########################################################
# install
#########################################################
install:
	mkdir -p "$(DESTDIR)"/bin
	install -m 755 vicl "$(DESTDIR)"/bin
	install -m 755 vicl_open_file "$(DESTDIR)"/bin
	install -m 755 vicl_insert_file "$(DESTDIR)"/bin

#########################################################
# uninstall
#########################################################
uninstall:
	rm -rf ~/.clover2/vicl
	rm -f "$(DESTDIR)"/bin/vicl

#########################################################
# permission
#########################################################
permission:
	chmod 644 *
	chmod 755 .git man src configure
	chmod 644 ViClone.clcl viclone.cl

########################################################
# clean
########################################################
clean:
	rm -fR core.* core a.out *.oclcl *.bc *.s *.o *.ocl *.clm src/*.dwo *.ll *.so.1.0.0 *.so vgcore* tags cstdlib-tags

distclean: clean
	rm -fR Makefile autom4te.cache

########################################################
# test
########################################################
test: 
	@echo "Compile to test code..."
