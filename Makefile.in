#######################################################
# installed directories
#######################################################
prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=@bindir@
datadir=@datadir@
mandir=@mandir@
sharedstatedir=@sharedstatedir@
sysconfdir=@sysconfdir@/clover2
includedir=@includedir@/clover2
datarootdir=@datarootdir@/clover2
docdir=@datadir@/doc
libdir=@libdir@


##########################################################
# environmnet variables
##########################################################
CC=@CC@
CXX=@CXX@
INSTALL=@INSTALL@
CFLAGS=@CFLAGS@
LIBS=@LIBS@
OS=@OS@
DESTDIR=@DESTDIR@
OBJS=@OBJS@
CXXFLAGS=@CXXFLAGS@

##########################################################
# main
##########################################################
all: vicl

vicl: CLParser.oclcl ViClone.oclcl viclone.ocl Clover.oclcl preinstall 

Clover.oclcl: Fundamental.clcl CLParser.clcl
	cclover2 -core Fundamental.clcl
	if test -e Clover.bc; then bclover2 Clover.bc; fi

CLParser.oclcl: CLParser.clcl
	cclover2 CLParser.clcl
	if test -e CLNodeType.bc; then bclover2 CLNodeType.bc; fi
	if test -e CLNodeTreeInt.bc; then bclover2 CLNodeTreeInt.bc; fi
	if test -e CLNodeTreePlus.bc; then bclover2 CLNodeTreePlus.bc; fi
	if test -e CLParser.bc; then bclover2 CLParser.bc; fi

ViClone.oclcl: ViClone.clcl ViClone2DirPane.clcl ViClone3View.clcl ViClone4InsertMode.clcl ViClone5CommandMode.clcl ViClone6Edit.clcl ViClone7Undo.clcl ViClone8MethodNameCompletion.clcl ViClone9SearchMode.clcl ViClone10MessageBox.clcl ViClone11VisualMode.clcl
	cclover2 ViClone11VisualMode.clcl
	if test -e ViClone.bc; then bclover2 ViClone.bc; fi

viclone.ocl: viclone.cl
	cclover2 viclone.cl
	install -m 644 viclone.ocl $(HOME)/.clover2/viclone.ocl

preinstall:
	mkdir -p $(HOME)/.clover2/vicl
	install -m 644 Clover.oclcl $(HOME)/.clover2/vicl
	if test -e libClover.so.1.0.0; then install -m 755 libClover.so.1.0.0 $(HOME)/.clover2/vicl; cp -a libClover.so $(HOME)/.clover2/vicl; fi
	install -m 644 ViClone.oclcl $(HOME)/.clover2/vicl
	if test -e libViClone.so.1.0.0; then install -m 755 libViClone.so.1.0.0 $(HOME)/.clover2/vicl; cp -a libViClone.so $(HOME)/.clover2/vicl; fi
	install -m 644 viclone.ocl $(HOME)/.clover2/vicl
	install -m 644 CLNodeType.oclcl $(HOME)/.clover2/vicl
	if test -e libCLNodeType.so.1.0.0; then install -m 755 libCLNodeType.so.1.0.0 $(HOME)/.clover2/vicl; cp -a libCLNodeType.so $(HOME)/.clover2/vicl; fi
	install -m 644 CLParser.oclcl $(HOME)/.clover2/vicl
	if test -e libCLParser.so.1.0.0; then install -m 755 libCLParser.so.1.0.0 $(HOME)/.clover2/vicl; cp -a libCLParser.so $(HOME)/.clover2/vicl; fi
	install -m 644 CLNodeTreePlus.oclcl $(HOME)/.clover2/vicl
	if test -e libCLNodeTreePlus.so.1.0.0; then install -m 755 libCLNodeTreePlus.so.1.0.0 $(HOME)/.clover2/vicl; cp -a libCLNodeTreePlus.so $(HOME)/.clover2/vicl; fi
	install -m 644 CLNodeTreeInt.oclcl $(HOME)/.clover2/vicl
	if test -e libCLNodeTreeInt.so.1.0.0; then install -m 755 libCLNodeTreeInt.so.1.0.0 $(HOME)/.clover2/vicl; cp -a libCLNodeTreeInt.so $(HOME)/.clover2/vicl; fi
	install -m 644 CLNodeTreeBase.clm $(HOME)/.clover2/vicl
	install -m 644 viclone.ocl $(HOME)/.clover2/vicl

#########################################################
# install
#########################################################
install:
	mkdir -p "$(DESTDIR)"/bin
	install -m 755 vicl "$(DESTDIR)"/bin

#########################################################
# uninstall
#########################################################
uninstall:
	rm -rf ~/.clover2/vicl
	rm -f "$(DESTDIR)"/bin/vicl

#########################################################
# permission
#########################################################
permission:
	chmod 644 *
	chmod 755 .git man src configure
	chmod 644 ViClone.clcl viclone.cl

########################################################
# clean
########################################################
clean:
	rm -fR core.* core a.out *.oclcl *.bc *.s *.o *.ocl *.clm src/*.dwo *.ll *.so.1.0.0 *.so vgcore*

distclean: clean
	rm -fR Makefile autom4te.cache

########################################################
# test
########################################################
test: 
	@echo "Compile to test code..."
